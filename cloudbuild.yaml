# Code Generated by Sidekick is for learning and experimentation purposes only.
substitutions:
  _REGION: us-central1
  _REPO: functions-repo
  _FUNC_NAME: hello-fn

steps:
  # 1. Install deps + run tests (none here, but placeholder)
  - name: python:3.11
    entrypoint: bash
    args:
      - -c
      - |
        pip install -r requirements.txt
        echo "No tests yet â€“ skipping."

  # 2. Build container image with Cloud Buildpacks
  - name: gcr.io/cloud-builders/pack
    args:
      - build
      - "$_REGION-docker.pkg.dev/$PROJECT_ID/$_REPO/$_FUNC_NAME:${SHORT_SHA}"
      - --path
      - .
      - --builder
      - gcr.io/buildpacks/builder:v1

  # 3. Deploy Cloud Function 2nd Gen
  - name: gcr.io/google.com/cloudsdktool/cloud-sdk
    entrypoint: gcloud
    args:
      - functions
      - deploy
      - "$_FUNC_NAME"
      - --gen2
      - --region=$_REGION
      - --runtime=python311
      - --source=.
      - --entry-point=app
      - --trigger-http
      - --allow-unauthenticated

images:
  - "$_REGION-docker.pkg.dev/$PROJECT_ID/$_REPO/$_FUNC_NAME:${SHORT_SHA}"
