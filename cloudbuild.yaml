# Code Generated by Sidekick is for learning and experimentation purposes only.
# cloudbuild.yaml – Deploy Python 3.11 Cloud Function (Gen2) with Cloud Build

options:
  logging: CLOUD_LOGGING_ONLY    # So we don’t need a logs bucket

substitutions:
  _REGION: us-central1           # Change if you’d like
  _FUNC_NAME: hello-fn

steps:
  # 1 Install dependencies and (optionally) run unit tests
  - name: python:3.11
    id: Test
    entrypoint: bash
    args:
      - -c
      - |
        pip install -r requirements.txt
        echo "No tests yet – skipping."

  # 2 Deploy Cloud Function; Cloud Build will build the container image internally
  - name: gcr.io/google.com/cloudsdktool/cloud-sdk
    id: Deploy
    entrypoint: bash
    args:
      - -c
      - |
        gcloud functions deploy "$_FUNC_NAME" \
          --gen2 \
          --region=$_REGION \
          --runtime=python311 \
          --source=. \
          --entry-point=app \
          --trigger-http \
          --allow-unauthenticated

# No custom images section is required when you let gcloud handle the build

